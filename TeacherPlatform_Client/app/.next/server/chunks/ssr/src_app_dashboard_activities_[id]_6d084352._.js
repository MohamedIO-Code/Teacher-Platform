module.exports=[9204,a=>{a.v({addBtn:"detail-module__sJVdpq__addBtn",avatar:"detail-module__sJVdpq__avatar",avatarTeacher:"detail-module__sJVdpq__avatarTeacher",backLink:"detail-module__sJVdpq__backLink",cancelBtn:"detail-module__sJVdpq__cancelBtn",categoryBadge:"detail-module__sJVdpq__categoryBadge",container:"detail-module__sJVdpq__container",deleteBtn:"detail-module__sJVdpq__deleteBtn",detailCard:"detail-module__sJVdpq__detailCard",detailsGrid:"detail-module__sJVdpq__detailsGrid",emptyText:"detail-module__sJVdpq__emptyText",evalBtn:"detail-module__sJVdpq__evalBtn",formError:"detail-module__sJVdpq__formError",formGroup:"detail-module__sJVdpq__formGroup",header:"detail-module__sJVdpq__header",headerActions:"detail-module__sJVdpq__headerActions",headerInfo:"detail-module__sJVdpq__headerInfo",loader:"detail-module__sJVdpq__loader",loading:"detail-module__sJVdpq__loading",modal:"detail-module__sJVdpq__modal",modalActions:"detail-module__sJVdpq__modalActions",modalForm:"detail-module__sJVdpq__modalForm",modalHeader:"detail-module__sJVdpq__modalHeader",modalOverlay:"detail-module__sJVdpq__modalOverlay",notFound:"detail-module__sJVdpq__notFound",participantActions:"detail-module__sJVdpq__participantActions",participantCard:"detail-module__sJVdpq__participantCard",participantGroup:"detail-module__sJVdpq__participantGroup",participantInfo:"detail-module__sJVdpq__participantInfo",participantMeta:"detail-module__sJVdpq__participantMeta",participantsList:"detail-module__sJVdpq__participantsList",participantsSection:"detail-module__sJVdpq__participantsSection",radioGroup:"detail-module__sJVdpq__radioGroup",removeBtn:"detail-module__sJVdpq__removeBtn",roleBadge:"detail-module__sJVdpq__roleBadge",scoreInput:"detail-module__sJVdpq__scoreInput",scoreValue:"detail-module__sJVdpq__scoreValue",sectionHeader:"detail-module__sJVdpq__sectionHeader",spin:"detail-module__sJVdpq__spin",statusBadge:"detail-module__sJVdpq__statusBadge",statusSelect:"detail-module__sJVdpq__statusSelect",statusabsent:"detail-module__sJVdpq__statusabsent",statusattended:"detail-module__sJVdpq__statusattended",statuscompleted:"detail-module__sJVdpq__statuscompleted",statusregistered:"detail-module__sJVdpq__statusregistered",submitBtn:"detail-module__sJVdpq__submitBtn"})},35901,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(32860),e=a.i(41675),f=a.i(41710),g=a.i(24987),h=a.i(60246),i=a.i(21374),j=a.i(17371),k=a.i(81560),l=a.i(33508),m=a.i(92e3),n=a.i(46842),o=a.i(38246),p=a.i(50944),q=a.i(9204);function r({params:a}){let r=(0,c.use)(a),u=(0,p.useRouter)(),[v,w]=(0,c.useState)(null),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),J=(0,c.useCallback)(async()=>{try{let a=await fetch(`/api/activities/${r.id}`),b=await a.json();b.activity&&w(b.activity)}catch(a){console.error("Failed to fetch activity:",a)}finally{C(!1)}},[r.id]),K=async()=>{try{let a=await fetch("/api/students?limit=100"),b=await a.json();y(b.students||[])}catch(a){console.error("Failed to fetch students:",a)}},L=async()=>{try{let a=await fetch("/api/teachers?limit=100&status=active"),b=await a.json();A(b.teachers||[])}catch(a){console.error("Failed to fetch teachers:",a)}};(0,c.useEffect)(()=>{J(),K(),L()},[J]);let M=async()=>{if(confirm("هل أنت متأكد من حذف هذا النشاط؟"))try{(await fetch(`/api/activities/${r.id}`,{method:"DELETE"})).ok&&u.push("/dashboard/activities")}catch(a){console.error("Failed to delete activity:",a)}},N=async a=>{try{(await fetch(`/api/activities/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:a})})).ok&&J()}catch(a){console.error("Failed to update status:",a)}},O=async a=>{if(confirm("هل أنت متأكد من إزالة هذا المشارك؟"))try{await fetch(`/api/participations?id=${a}`,{method:"DELETE"}),J()}catch(a){console.error("Failed to remove participant:",a)}},P=a=>({upcoming:"قادمة",ongoing:"جارية",completed:"منتهية",cancelled:"ملغاة",registered:"مسجل",attended:"حضر",absent:"غائب"})[a]||a,Q=a=>({participant:"مشارك",organizer:"منظم",presenter:"مقدم",judge:"محكم"})[a]||a;if(B)return(0,b.jsxs)("div",{className:q.default.loading,children:[(0,b.jsx)("div",{className:q.default.loader}),(0,b.jsx)("p",{children:"جاري التحميل..."})]});if(!v)return(0,b.jsxs)("div",{className:q.default.notFound,children:[(0,b.jsx)(m.AlertCircle,{size:48}),(0,b.jsx)("h2",{children:"النشاط غير موجود"}),(0,b.jsx)(o.default,{href:"/dashboard/activities",children:"العودة للأنشطة"})]});let R=v.participations.filter(a=>a.student),S=v.participations.filter(a=>a.teacher);return(0,b.jsxs)("div",{className:q.default.container,children:[(0,b.jsxs)(o.default,{href:"/dashboard/activities",className:q.default.backLink,children:[(0,b.jsx)(d.ArrowRight,{size:18}),"العودة لقائمة الأنشطة"]}),(0,b.jsxs)("div",{className:q.default.header,children:[(0,b.jsxs)("div",{className:q.default.headerInfo,children:[(0,b.jsx)("span",{className:q.default.categoryBadge,children:v.category.name}),(0,b.jsx)("h1",{children:v.title}),v.description&&(0,b.jsx)("p",{children:v.description})]}),(0,b.jsxs)("div",{className:q.default.headerActions,children:[(0,b.jsxs)("select",{value:v.status,onChange:a=>N(a.target.value),className:q.default.statusSelect,children:[(0,b.jsx)("option",{value:"upcoming",children:"قادمة"}),(0,b.jsx)("option",{value:"ongoing",children:"جارية"}),(0,b.jsx)("option",{value:"completed",children:"منتهية"}),(0,b.jsx)("option",{value:"cancelled",children:"ملغاة"})]}),(0,b.jsx)("button",{className:q.default.deleteBtn,onClick:M,children:(0,b.jsx)(k.Trash2,{size:18})})]})]}),(0,b.jsxs)("div",{className:q.default.detailsGrid,children:[(0,b.jsxs)("div",{className:q.default.detailCard,children:[(0,b.jsx)(e.Calendar,{size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"التاريخ"}),(0,b.jsx)("strong",{children:new Date(v.date).toLocaleDateString("ar-SA",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),v.time&&(0,b.jsxs)("div",{className:q.default.detailCard,children:[(0,b.jsx)(f.Clock,{size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"الوقت"}),(0,b.jsx)("strong",{children:v.time})]})]}),v.location&&(0,b.jsxs)("div",{className:q.default.detailCard,children:[(0,b.jsx)(g.MapPin,{size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"المكان"}),(0,b.jsx)("strong",{children:v.location})]})]}),(0,b.jsxs)("div",{className:q.default.detailCard,children:[(0,b.jsx)(h.Users,{size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"المشاركين"}),(0,b.jsxs)("strong",{children:[v.participations.length," ",v.maxParticipants?`/ ${v.maxParticipants}`:""]})]})]}),v.teacher&&(0,b.jsxs)("div",{className:q.default.detailCard,children:[(0,b.jsx)(n.User,{size:20}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{children:"المسؤول"}),(0,b.jsx)("strong",{children:v.teacher.name})]})]})]}),(0,b.jsxs)("div",{className:q.default.participantsSection,children:[(0,b.jsxs)("div",{className:q.default.sectionHeader,children:[(0,b.jsx)("h2",{children:"المشاركون"}),(0,b.jsxs)("button",{className:q.default.addBtn,onClick:()=>E(!0),children:[(0,b.jsx)(j.UserPlus,{size:18}),"إضافة مشارك"]})]}),(0,b.jsxs)("div",{className:q.default.participantGroup,children:[(0,b.jsxs)("h3",{children:["الطلاب (",R.length,")"]}),0===R.length?(0,b.jsx)("p",{className:q.default.emptyText,children:"لم يتم تسجيل طلاب بعد"}):(0,b.jsx)("div",{className:q.default.participantsList,children:R.map(a=>(0,b.jsxs)("div",{className:q.default.participantCard,children:[(0,b.jsxs)("div",{className:q.default.participantInfo,children:[(0,b.jsx)("div",{className:q.default.avatar,children:a.student?.name.charAt(0)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{children:a.student?.name}),(0,b.jsxs)("span",{children:[a.student?.studentId," - ",a.student?.grade]})]})]}),(0,b.jsxs)("div",{className:q.default.participantMeta,children:[(0,b.jsx)("span",{className:q.default.roleBadge,children:Q(a.role)}),(0,b.jsx)("span",{className:`${q.default.statusBadge} ${q.default[`status${a.status}`]}`,children:P(a.status)})]}),(0,b.jsxs)("div",{className:q.default.participantActions,children:[(0,b.jsxs)("button",{className:q.default.evalBtn,onClick:()=>{I(a),G(!0)},children:[(0,b.jsx)(i.Star,{size:16}),a.evaluations.length>0?`${a.evaluations[0].score}/10`:"تقييم"]}),(0,b.jsx)("button",{className:q.default.removeBtn,onClick:()=>O(a.id),children:(0,b.jsx)(l.X,{size:16})})]})]},a.id))})]}),(0,b.jsxs)("div",{className:q.default.participantGroup,children:[(0,b.jsxs)("h3",{children:["المدرسون (",S.length,")"]}),0===S.length?(0,b.jsx)("p",{className:q.default.emptyText,children:"لم يتم تسجيل مدرسين بعد"}):(0,b.jsx)("div",{className:q.default.participantsList,children:S.map(a=>(0,b.jsxs)("div",{className:q.default.participantCard,children:[(0,b.jsxs)("div",{className:q.default.participantInfo,children:[(0,b.jsx)("div",{className:q.default.avatarTeacher,children:a.teacher?.name.charAt(0)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{children:a.teacher?.name}),(0,b.jsx)("span",{children:a.teacher?.employeeId})]})]}),(0,b.jsxs)("div",{className:q.default.participantMeta,children:[(0,b.jsx)("span",{className:q.default.roleBadge,children:Q(a.role)}),(0,b.jsx)("span",{className:`${q.default.statusBadge} ${q.default[`status${a.status}`]}`,children:P(a.status)})]}),(0,b.jsxs)("div",{className:q.default.participantActions,children:[(0,b.jsxs)("button",{className:q.default.evalBtn,onClick:()=>{I(a),G(!0)},children:[(0,b.jsx)(i.Star,{size:16}),a.evaluations.length>0?`${a.evaluations[0].score}/10`:"تقييم"]}),(0,b.jsx)("button",{className:q.default.removeBtn,onClick:()=>O(a.id),children:(0,b.jsx)(l.X,{size:16})})]})]},a.id))})]})]}),D&&(0,b.jsx)(s,{activityId:v.id,students:x,teachers:z,existingStudentIds:R.map(a=>a.student?.id).filter(Boolean),existingTeacherIds:S.map(a=>a.teacher?.id).filter(Boolean),onClose:()=>E(!1),onSave:()=>{E(!1),J()}}),F&&H&&(0,b.jsx)(t,{participation:H,onClose:()=>{G(!1),I(null)},onSave:()=>{G(!1),I(null),J()}})]})}function s({activityId:a,students:d,teachers:e,existingStudentIds:f,existingTeacherIds:g,onClose:h,onSave:i}){let[j,k]=(0,c.useState)("student"),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)("participant"),[r,s]=(0,c.useState)(!1),[t,u]=(0,c.useState)(""),v=d.filter(a=>!f.includes(a.id)),w=e.filter(a=>!g.includes(a.id)),x=async b=>{if(b.preventDefault(),!m)return void u("يرجى اختيار المشارك");s(!0),u("");try{let b=await fetch("/api/participations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityId:a,["student"===j?"studentId":"teacherId"]:m,role:o})}),c=await b.json();if(!b.ok)return void u(c.error||"حدث خطأ");i()}catch{u("حدث خطأ في الاتصال")}finally{s(!1)}};return(0,b.jsx)("div",{className:q.default.modalOverlay,onClick:h,children:(0,b.jsxs)("div",{className:q.default.modal,onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:q.default.modalHeader,children:[(0,b.jsx)("h2",{children:"إضافة مشارك"}),(0,b.jsx)("button",{onClick:h,children:(0,b.jsx)(l.X,{size:20})})]}),(0,b.jsxs)("form",{onSubmit:x,className:q.default.modalForm,children:[(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"نوع المشارك"}),(0,b.jsxs)("div",{className:q.default.radioGroup,children:[(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"radio",checked:"student"===j,onChange:()=>{k("student"),n("")}}),"طالب"]}),(0,b.jsxs)("label",{children:[(0,b.jsx)("input",{type:"radio",checked:"teacher"===j,onChange:()=>{k("teacher"),n("")}}),"مدرس"]})]})]}),(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsxs)("label",{children:["اختر ","student"===j?"الطالب":"المدرس"]}),(0,b.jsxs)("select",{value:m,onChange:a=>n(a.target.value),required:!0,children:[(0,b.jsx)("option",{value:"",children:"اختر..."}),"student"===j?v.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," - ",a.studentId]},a.id)):w.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," - ",a.employeeId]},a.id))]})]}),(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"الدور"}),(0,b.jsxs)("select",{value:o,onChange:a=>p(a.target.value),children:[(0,b.jsx)("option",{value:"participant",children:"مشارك"}),(0,b.jsx)("option",{value:"organizer",children:"منظم"}),(0,b.jsx)("option",{value:"presenter",children:"مقدم"}),(0,b.jsx)("option",{value:"judge",children:"محكم"})]})]}),t&&(0,b.jsx)("div",{className:q.default.formError,children:t}),(0,b.jsxs)("div",{className:q.default.modalActions,children:[(0,b.jsx)("button",{type:"button",onClick:h,className:q.default.cancelBtn,children:"إلغاء"}),(0,b.jsx)("button",{type:"submit",className:q.default.submitBtn,disabled:r,children:r?"جاري الإضافة...":"إضافة"})]})]})]})})}function t({participation:a,onClose:d,onSave:e}){let f=a.evaluations[0],[g,h]=(0,c.useState)({score:f?.score||7,performance:f?.performance||"",strengths:f?.strengths||"",improvements:f?.improvements||"",comments:f?.comments||""}),[i,j]=(0,c.useState)(!1),[k,m]=(0,c.useState)(""),n=a.student?.name||a.teacher?.name||"",o=async b=>{b.preventDefault(),j(!0),m("");try{let b=await fetch("/api/activity-evaluations",{method:f?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:f?.id,participationId:a.id,...g})}),c=await b.json();if(!b.ok)return void m(c.error||"حدث خطأ");e()}catch{m("حدث خطأ في الاتصال")}finally{j(!1)}};return(0,b.jsx)("div",{className:q.default.modalOverlay,onClick:d,children:(0,b.jsxs)("div",{className:q.default.modal,onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:q.default.modalHeader,children:[(0,b.jsxs)("h2",{children:["تقييم ",n]}),(0,b.jsx)("button",{onClick:d,children:(0,b.jsx)(l.X,{size:20})})]}),(0,b.jsxs)("form",{onSubmit:o,className:q.default.modalForm,children:[(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"التقييم (1-10)"}),(0,b.jsxs)("div",{className:q.default.scoreInput,children:[(0,b.jsx)("input",{type:"range",min:"1",max:"10",value:g.score,onChange:a=>h({...g,score:parseInt(a.target.value)})}),(0,b.jsxs)("span",{className:q.default.scoreValue,children:[g.score,"/10"]})]})]}),(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"مستوى الأداء"}),(0,b.jsxs)("select",{value:g.performance,onChange:a=>h({...g,performance:a.target.value}),children:[(0,b.jsx)("option",{value:"",children:"اختر..."}),(0,b.jsx)("option",{value:"ممتاز",children:"ممتاز"}),(0,b.jsx)("option",{value:"جيد جداً",children:"جيد جداً"}),(0,b.jsx)("option",{value:"جيد",children:"جيد"}),(0,b.jsx)("option",{value:"مقبول",children:"مقبول"}),(0,b.jsx)("option",{value:"ضعيف",children:"ضعيف"})]})]}),(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"نقاط القوة"}),(0,b.jsx)("textarea",{value:g.strengths,onChange:a=>h({...g,strengths:a.target.value}),rows:2,placeholder:"أذكر نقاط القوة..."})]}),(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"نقاط التحسين"}),(0,b.jsx)("textarea",{value:g.improvements,onChange:a=>h({...g,improvements:a.target.value}),rows:2,placeholder:"أذكر نقاط التحسين..."})]}),(0,b.jsxs)("div",{className:q.default.formGroup,children:[(0,b.jsx)("label",{children:"ملاحظات إضافية"}),(0,b.jsx)("textarea",{value:g.comments,onChange:a=>h({...g,comments:a.target.value}),rows:2,placeholder:"ملاحظات..."})]}),k&&(0,b.jsx)("div",{className:q.default.formError,children:k}),(0,b.jsxs)("div",{className:q.default.modalActions,children:[(0,b.jsx)("button",{type:"button",onClick:d,className:q.default.cancelBtn,children:"إلغاء"}),(0,b.jsx)("button",{type:"submit",className:q.default.submitBtn,disabled:i,children:i?"جاري الحفظ...":"حفظ التقييم"})]})]})]})})}a.s(["default",()=>r])}];

//# sourceMappingURL=src_app_dashboard_activities_%5Bid%5D_6d084352._.js.map