module.exports=[81868,a=>{a.v({actionBtn:"attendance-module__Bxmkza__actionBtn",addButton:"attendance-module__Bxmkza__addButton",avatar:"attendance-module__Bxmkza__avatar",btnAbsent:"attendance-module__Bxmkza__btnAbsent",btnCheckout:"attendance-module__Bxmkza__btnCheckout",btnLate:"attendance-module__Bxmkza__btnLate",btnPresent:"attendance-module__Bxmkza__btnPresent",cancelBtn:"attendance-module__Bxmkza__cancelBtn",closeModal:"attendance-module__Bxmkza__closeModal",container:"attendance-module__Bxmkza__container",controls:"attendance-module__Bxmkza__controls",dateDisplay:"attendance-module__Bxmkza__dateDisplay",dateInput:"attendance-module__Bxmkza__dateInput",dateNav:"attendance-module__Bxmkza__dateNav",empty:"attendance-module__Bxmkza__empty",filterGroup:"attendance-module__Bxmkza__filterGroup",filterSelect:"attendance-module__Bxmkza__filterSelect",formError:"attendance-module__Bxmkza__formError",formGroup:"attendance-module__Bxmkza__formGroup",header:"attendance-module__Bxmkza__header",loader:"attendance-module__Bxmkza__loader",loading:"attendance-module__Bxmkza__loading",modal:"attendance-module__Bxmkza__modal",modalActions:"attendance-module__Bxmkza__modalActions",modalForm:"attendance-module__Bxmkza__modalForm",modalHeader:"attendance-module__Bxmkza__modalHeader",modalOverlay:"attendance-module__Bxmkza__modalOverlay",navBtn:"attendance-module__Bxmkza__navBtn",pageBtn:"attendance-module__Bxmkza__pageBtn",pageInfo:"attendance-module__Bxmkza__pageInfo",pagination:"attendance-module__Bxmkza__pagination",quickActions:"attendance-module__Bxmkza__quickActions",quickAdd:"attendance-module__Bxmkza__quickAdd",quickBtn:"attendance-module__Bxmkza__quickBtn",registeredBadge:"attendance-module__Bxmkza__registeredBadge",slideUp:"attendance-module__Bxmkza__slideUp",spin:"attendance-module__Bxmkza__spin",statAbsent:"attendance-module__Bxmkza__statAbsent",statCard:"attendance-module__Bxmkza__statCard",statExcused:"attendance-module__Bxmkza__statExcused",statLabel:"attendance-module__Bxmkza__statLabel",statLate:"attendance-module__Bxmkza__statLate",statPresent:"attendance-module__Bxmkza__statPresent",statValue:"attendance-module__Bxmkza__statValue",statsGrid:"attendance-module__Bxmkza__statsGrid",status:"attendance-module__Bxmkza__status",statusAbsent:"attendance-module__Bxmkza__statusAbsent",statusExcused:"attendance-module__Bxmkza__statusExcused",statusLate:"attendance-module__Bxmkza__statusLate",statusPresent:"attendance-module__Bxmkza__statusPresent",submitBtn:"attendance-module__Bxmkza__submitBtn",subtitle:"attendance-module__Bxmkza__subtitle",table:"attendance-module__Bxmkza__table",tableCard:"attendance-module__Bxmkza__tableCard",teacherButtons:"attendance-module__Bxmkza__teacherButtons",teacherId:"attendance-module__Bxmkza__teacherId",teacherInfo:"attendance-module__Bxmkza__teacherInfo",teacherName:"attendance-module__Bxmkza__teacherName",title:"attendance-module__Bxmkza__title"})},16830,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(41675),e=a.i(76803),f=a.i(41710),g=a.i(46864),h=a.i(72893),i=a.i(92e3),j=a.i(16201),k=a.i(62722),l=a.i(50522),m=a.i(13749),n=a.i(69012),o=a.i(15618),p=a.i(33508),q=a.i(20005),r=a.i(81868);function s(){let[a,p]=(0,c.useState)([]),[s,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(!0),[x,y]=(0,c.useState)(new Date().toISOString().split("T")[0]),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(1),[D,E]=(0,c.useState)(1),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)({present:0,absent:0,late:0,excused:0}),P=(0,c.useCallback)(async()=>{w(!0);try{let a=new URLSearchParams({page:B.toString(),limit:"20",startDate:x,endDate:x});z&&a.set("status",z);let b=await fetch(`/api/attendance?${a}`),c=await b.json();p(c.records),E(c.pagination.totalPages||1);let d={present:0,absent:0,late:0,excused:0};c.records.forEach(a=>{a.status in d&&d[a.status]++}),O(d)}catch(a){console.error("Failed to fetch attendance:",a)}finally{w(!1)}},[B,x,z]),Q=async()=>{try{let a=await fetch("/api/teachers?limit=100"),b=await a.json();u(b.teachers||[])}catch(a){console.error("Failed to fetch teachers:",a)}},R=async()=>{try{let a=await fetch("/api/auth/session"),b=await a.json();b.authenticated&&I(b.user)}catch(a){console.error("Failed to fetch user:",a)}};(0,c.useEffect)(()=>{P()},[P]),(0,c.useEffect)(()=>{Q(),R()},[]),(0,c.useEffect)(()=>{if(H?.role==="teacher"&&a.length>0){let b=new Date().toISOString().split("T")[0];M(!!a.find(a=>a.date.split("T")[0]===b))}},[a,H]);let S=async()=>{K(!0);try{let a=new Date,b=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selfRegister:!0,date:a.toISOString().split("T")[0],checkIn:a.toISOString(),status:"present"})});if(b.ok)M(!0),P();else{let a=await b.json();alert(a.error||"حدث خطأ في تسجيل الحضور")}}catch(a){console.error("Failed to register attendance:",a),alert("حدث خطأ في الاتصال")}finally{K(!1)}},T=H?.role==="teacher",U=async(a,b)=>{try{let c=new Date,d="present"===b||"late"===b?c.toISOString():null;await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacherId:a,date:x,checkIn:d,status:b})}),P()}catch(a){console.error("Failed to mark attendance:",a)}},V=async a=>{try{let b=new Date;await fetch(`/api/attendance/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkOut:b.toISOString()})}),P()}catch(a){console.error("Failed to record checkout:",a)}},W=a=>a?new Date(a).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"-",X=a=>{let b=new Date(x);b.setDate(b.getDate()+a),y(b.toISOString().split("T")[0]),C(1)};return(0,b.jsxs)("div",{className:r.default.container,children:[(0,b.jsxs)("div",{className:r.default.header,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:r.default.title,children:"الحضور والانصراف"}),(0,b.jsx)("p",{className:r.default.subtitle,children:T?"سجلات حضورك وانصرافك":"تسجيل ومتابعة حضور وانصراف المدرسين"})]}),T?L?(0,b.jsxs)("div",{className:r.default.registeredBadge,children:[(0,b.jsx)(j.CheckCircle,{size:18}),"تم تسجيل حضورك اليوم ✓"]}):(0,b.jsxs)("button",{className:r.default.addButton,onClick:S,disabled:J,children:[(0,b.jsx)(g.UserCheck,{size:18}),J?"جاري التسجيل...":"تسجيل حضوري"]}):(0,b.jsxs)("button",{className:r.default.addButton,onClick:()=>G(!0),children:[(0,b.jsx)(o.Plus,{size:18}),"تسجيل الحضور"]})]}),(0,b.jsxs)("div",{className:r.default.statsGrid,children:[(0,b.jsxs)("div",{className:`${r.default.statCard} ${r.default.statPresent}`,children:[(0,b.jsx)(g.UserCheck,{size:24}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:r.default.statValue,children:N.present}),(0,b.jsx)("p",{className:r.default.statLabel,children:"حاضر"})]})]}),(0,b.jsxs)("div",{className:`${r.default.statCard} ${r.default.statAbsent}`,children:[(0,b.jsx)(h.UserMinus,{size:24}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:r.default.statValue,children:N.absent}),(0,b.jsx)("p",{className:r.default.statLabel,children:"غائب"})]})]}),(0,b.jsxs)("div",{className:`${r.default.statCard} ${r.default.statLate}`,children:[(0,b.jsx)(f.Clock,{size:24}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:r.default.statValue,children:N.late}),(0,b.jsx)("p",{className:r.default.statLabel,children:"متأخر"})]})]}),(0,b.jsxs)("div",{className:`${r.default.statCard} ${r.default.statExcused}`,children:[(0,b.jsx)(i.AlertCircle,{size:24}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:r.default.statValue,children:N.excused}),(0,b.jsx)("p",{className:r.default.statLabel,children:"إجازة"})]})]})]}),(0,b.jsxs)("div",{className:r.default.controls,children:[(0,b.jsxs)("div",{className:r.default.dateNav,children:[(0,b.jsx)("button",{className:r.default.navBtn,onClick:()=>X(-1),children:(0,b.jsx)(l.ChevronRight,{size:20})}),(0,b.jsxs)("div",{className:r.default.dateDisplay,children:[(0,b.jsx)(d.Calendar,{size:18}),(0,b.jsx)("input",{type:"date",value:x,onChange:a=>{y(a.target.value),C(1)},className:r.default.dateInput})]}),(0,b.jsx)("button",{className:r.default.navBtn,onClick:()=>X(1),children:(0,b.jsx)(m.ChevronLeft,{size:20})})]}),(0,b.jsxs)("div",{className:r.default.filterGroup,children:[(0,b.jsx)(n.Filter,{size:18}),(0,b.jsxs)("select",{value:z,onChange:a=>{A(a.target.value),C(1)},className:r.default.filterSelect,children:[(0,b.jsx)("option",{value:"",children:"جميع الحالات"}),(0,b.jsx)("option",{value:"present",children:"حاضر"}),(0,b.jsx)("option",{value:"absent",children:"غائب"}),(0,b.jsx)("option",{value:"late",children:"متأخر"}),(0,b.jsx)("option",{value:"excused",children:"إجازة"})]})]})]}),(0,b.jsx)("div",{className:r.default.tableCard,children:v?(0,b.jsxs)("div",{className:r.default.loading,children:[(0,b.jsx)("div",{className:r.default.loader}),(0,b.jsx)("p",{children:"جاري التحميل..."})]}):0===a.length?(0,b.jsxs)("div",{className:r.default.empty,children:[(0,b.jsx)(e.ClipboardCheck,{size:48}),(0,b.jsx)("h3",{children:"لا توجد سجلات"}),(0,b.jsx)("p",{children:"لم يتم تسجيل حضور في هذا اليوم"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("table",{className:r.default.table,children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"المدرس"}),(0,b.jsx)("th",{children:"الحالة"}),(0,b.jsx)("th",{children:"وقت الحضور"}),(0,b.jsx)("th",{children:"وقت الانصراف"}),(0,b.jsx)("th",{children:"ملاحظات"}),!T&&(0,b.jsx)("th",{children:"إجراءات"})]})}),(0,b.jsx)("tbody",{children:a.map(a=>{var c;let d,e=(c=a.status,(d={present:{label:"حاضر",icon:(0,b.jsx)(j.CheckCircle,{size:16}),class:"statusPresent"},absent:{label:"غائب",icon:(0,b.jsx)(k.XCircle,{size:16}),class:"statusAbsent"},late:{label:"متأخر",icon:(0,b.jsx)(f.Clock,{size:16}),class:"statusLate"},excused:{label:"إجازة",icon:(0,b.jsx)(i.AlertCircle,{size:16}),class:"statusExcused"}})[c]||d.present);return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{children:(0,b.jsxs)("div",{className:r.default.teacherInfo,children:[(0,b.jsx)("div",{className:r.default.avatar,children:a.teacher.name.charAt(0)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:r.default.teacherName,children:a.teacher.name}),(0,b.jsx)("p",{className:r.default.teacherId,children:a.teacher.employeeId})]})]})}),(0,b.jsx)("td",{children:(0,b.jsxs)("span",{className:`${r.default.status} ${r.default[e.class]}`,children:[e.icon,e.label]})}),(0,b.jsx)("td",{children:W(a.checkIn)}),(0,b.jsx)("td",{children:W(a.checkOut)}),(0,b.jsx)("td",{children:a.notes||"-"}),!T&&(0,b.jsx)("td",{children:(0,b.jsxs)("div",{className:r.default.quickActions,children:[(0,b.jsx)("button",{className:`${r.default.actionBtn} ${r.default.btnPresent}`,onClick:()=>U(a.teacherId,"present"),title:"حاضر",children:(0,b.jsx)(j.CheckCircle,{size:14})}),(0,b.jsx)("button",{className:`${r.default.actionBtn} ${r.default.btnLate}`,onClick:()=>U(a.teacherId,"late"),title:"متأخر",children:(0,b.jsx)(f.Clock,{size:14})}),(0,b.jsx)("button",{className:`${r.default.actionBtn} ${r.default.btnAbsent}`,onClick:()=>U(a.teacherId,"absent"),title:"غائب",children:(0,b.jsx)(k.XCircle,{size:14})}),("present"===a.status||"late"===a.status)&&a.checkIn&&!a.checkOut&&(0,b.jsx)("button",{className:`${r.default.actionBtn} ${r.default.btnCheckout}`,onClick:()=>V(a.id),title:"تسجيل الانصراف",children:(0,b.jsx)(q.LogOut,{size:14})})]})})]},a.id)})})]}),D>1&&(0,b.jsxs)("div",{className:r.default.pagination,children:[(0,b.jsxs)("button",{className:r.default.pageBtn,disabled:1===B,onClick:()=>C(a=>a-1),children:[(0,b.jsx)(l.ChevronRight,{size:18}),"السابق"]}),(0,b.jsxs)("span",{className:r.default.pageInfo,children:["صفحة ",B," من ",D]}),(0,b.jsxs)("button",{className:r.default.pageBtn,disabled:B===D,onClick:()=>C(a=>a+1),children:["التالي",(0,b.jsx)(m.ChevronLeft,{size:18})]})]})]})}),F&&(0,b.jsx)(t,{teachers:s,selectedDate:x,onClose:()=>G(!1),onSave:()=>{G(!1),P()}})]})}function t({teachers:a,selectedDate:d,onClose:e,onSave:f}){let[g,h]=(0,c.useState)({teacherId:"",status:"present",checkInTime:new Date().toTimeString().slice(0,5)}),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(""),m=async a=>{if(a.preventDefault(),!g.teacherId)return void l("يرجى اختيار المدرس");j(!0),l("");try{let[a,b]=g.checkInTime.split(":"),c=new Date(d);c.setHours(parseInt(a),parseInt(b),0,0);let e="present"===g.status||"late"===g.status?c.toISOString():null,h=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacherId:parseInt(g.teacherId),date:d,checkIn:e,status:g.status})});if(!h.ok){let a=await h.json();l(a.error||"حدث خطأ");return}f()}catch{l("حدث خطأ في الاتصال")}finally{j(!1)}};return(0,b.jsx)("div",{className:r.default.modalOverlay,onClick:e,children:(0,b.jsxs)("div",{className:r.default.modal,onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:r.default.modalHeader,children:[(0,b.jsx)("h2",{children:"تسجيل الحضور"}),(0,b.jsx)("button",{className:r.default.closeModal,onClick:e,children:(0,b.jsx)(p.X,{size:20})})]}),(0,b.jsxs)("form",{onSubmit:m,className:r.default.modalForm,children:[(0,b.jsxs)("div",{className:r.default.formGroup,children:[(0,b.jsx)("label",{children:"المدرس *"}),(0,b.jsxs)("select",{value:g.teacherId,onChange:a=>h({...g,teacherId:a.target.value}),required:!0,children:[(0,b.jsx)("option",{value:"",children:"اختر المدرس"}),a.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:r.default.formGroup,children:[(0,b.jsx)("label",{children:"حالة الحضور *"}),(0,b.jsxs)("select",{value:g.status,onChange:a=>h({...g,status:a.target.value}),children:[(0,b.jsx)("option",{value:"present",children:"حاضر"}),(0,b.jsx)("option",{value:"late",children:"متأخر"}),(0,b.jsx)("option",{value:"absent",children:"غائب"}),(0,b.jsx)("option",{value:"excused",children:"إجازة"})]})]}),("present"===g.status||"late"===g.status)&&(0,b.jsxs)("div",{className:r.default.formGroup,children:[(0,b.jsx)("label",{children:"وقت الحضور"}),(0,b.jsx)("input",{type:"time",value:g.checkInTime,onChange:a=>h({...g,checkInTime:a.target.value})})]}),k&&(0,b.jsx)("div",{className:r.default.formError,children:k}),(0,b.jsxs)("div",{className:r.default.modalActions,children:[(0,b.jsx)("button",{type:"button",className:r.default.cancelBtn,onClick:e,children:"إلغاء"}),(0,b.jsx)("button",{type:"submit",className:r.default.submitBtn,disabled:i,children:i?"جاري الحفظ...":"تسجيل"})]})]})]})})}a.s(["default",()=>s])}];

//# sourceMappingURL=src_app_dashboard_attendance_dc7e7261._.js.map