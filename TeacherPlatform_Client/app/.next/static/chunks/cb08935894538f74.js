(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,84614,e=>{"use strict";let a=(0,e.i(75254).default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>a],84614)},27612,e=>{"use strict";let a=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>a],27612)},87316,e=>{"use strict";let a=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>a],87316)},3116,e=>{"use strict";let a=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>a],3116)},63209,e=>{"use strict";let a=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>a],63209)},72520,e=>{"use strict";let a=(0,e.i(75254).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>a],72520)},46897,e=>{"use strict";let a=(0,e.i(75254).default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>a],46897)},79002,e=>{"use strict";let a=(0,e.i(75254).default)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserPlus",()=>a],79002)},69696,e=>{e.v({addBtn:"detail-module__sJVdpq__addBtn",avatar:"detail-module__sJVdpq__avatar",avatarTeacher:"detail-module__sJVdpq__avatarTeacher",backLink:"detail-module__sJVdpq__backLink",cancelBtn:"detail-module__sJVdpq__cancelBtn",categoryBadge:"detail-module__sJVdpq__categoryBadge",container:"detail-module__sJVdpq__container",deleteBtn:"detail-module__sJVdpq__deleteBtn",detailCard:"detail-module__sJVdpq__detailCard",detailsGrid:"detail-module__sJVdpq__detailsGrid",emptyText:"detail-module__sJVdpq__emptyText",evalBtn:"detail-module__sJVdpq__evalBtn",formError:"detail-module__sJVdpq__formError",formGroup:"detail-module__sJVdpq__formGroup",header:"detail-module__sJVdpq__header",headerActions:"detail-module__sJVdpq__headerActions",headerInfo:"detail-module__sJVdpq__headerInfo",loader:"detail-module__sJVdpq__loader",loading:"detail-module__sJVdpq__loading",modal:"detail-module__sJVdpq__modal",modalActions:"detail-module__sJVdpq__modalActions",modalForm:"detail-module__sJVdpq__modalForm",modalHeader:"detail-module__sJVdpq__modalHeader",modalOverlay:"detail-module__sJVdpq__modalOverlay",notFound:"detail-module__sJVdpq__notFound",participantActions:"detail-module__sJVdpq__participantActions",participantCard:"detail-module__sJVdpq__participantCard",participantGroup:"detail-module__sJVdpq__participantGroup",participantInfo:"detail-module__sJVdpq__participantInfo",participantMeta:"detail-module__sJVdpq__participantMeta",participantsList:"detail-module__sJVdpq__participantsList",participantsSection:"detail-module__sJVdpq__participantsSection",radioGroup:"detail-module__sJVdpq__radioGroup",removeBtn:"detail-module__sJVdpq__removeBtn",roleBadge:"detail-module__sJVdpq__roleBadge",scoreInput:"detail-module__sJVdpq__scoreInput",scoreValue:"detail-module__sJVdpq__scoreValue",sectionHeader:"detail-module__sJVdpq__sectionHeader",spin:"detail-module__sJVdpq__spin",statusBadge:"detail-module__sJVdpq__statusBadge",statusSelect:"detail-module__sJVdpq__statusSelect",statusabsent:"detail-module__sJVdpq__statusabsent",statusattended:"detail-module__sJVdpq__statusattended",statuscompleted:"detail-module__sJVdpq__statuscompleted",statusregistered:"detail-module__sJVdpq__statusregistered",submitBtn:"detail-module__sJVdpq__submitBtn"})},89781,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(72520),i=e.i(87316),l=e.i(3116),d=e.i(46897),r=e.i(61911),n=e.i(70273),c=e.i(79002),o=e.i(27612),u=e.i(37727),p=e.i(63209),h=e.i(84614),m=e.i(22016),x=e.i(18566),_=e.i(69696);function j({params:e}){let j=(0,t.use)(e),y=(0,x.useRouter)(),[g,N]=(0,t.useState)(null),[k,b]=(0,t.useState)([]),[q,V]=(0,t.useState)([]),[C,J]=(0,t.useState)(!0),[B,S]=(0,t.useState)(!1),[w,T]=(0,t.useState)(!1),[I,A]=(0,t.useState)(null),G=(0,t.useCallback)(async()=>{try{let e=await fetch(`/api/activities/${j.id}`),a=await e.json();a.activity&&N(a.activity)}catch(e){console.error("Failed to fetch activity:",e)}finally{J(!1)}},[j.id]),z=async()=>{try{let e=await fetch("/api/students?limit=100"),a=await e.json();b(a.students||[])}catch(e){console.error("Failed to fetch students:",e)}},M=async()=>{try{let e=await fetch("/api/teachers?limit=100&status=active"),a=await e.json();V(a.teachers||[])}catch(e){console.error("Failed to fetch teachers:",e)}};(0,t.useEffect)(()=>{G(),z(),M()},[G]);let P=async()=>{if(confirm("هل أنت متأكد من حذف هذا النشاط؟"))try{(await fetch(`/api/activities/${j.id}`,{method:"DELETE"})).ok&&y.push("/dashboard/activities")}catch(e){console.error("Failed to delete activity:",e)}},F=async e=>{try{(await fetch(`/api/activities/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})})).ok&&G()}catch(e){console.error("Failed to update status:",e)}},$=async e=>{if(confirm("هل أنت متأكد من إزالة هذا المشارك؟"))try{await fetch(`/api/participations?id=${e}`,{method:"DELETE"}),G()}catch(e){console.error("Failed to remove participant:",e)}},E=e=>({upcoming:"قادمة",ongoing:"جارية",completed:"منتهية",cancelled:"ملغاة",registered:"مسجل",attended:"حضر",absent:"غائب"})[e]||e,O=e=>({participant:"مشارك",organizer:"منظم",presenter:"مقدم",judge:"محكم"})[e]||e;if(C)return(0,a.jsxs)("div",{className:_.default.loading,children:[(0,a.jsx)("div",{className:_.default.loader}),(0,a.jsx)("p",{children:"جاري التحميل..."})]});if(!g)return(0,a.jsxs)("div",{className:_.default.notFound,children:[(0,a.jsx)(p.AlertCircle,{size:48}),(0,a.jsx)("h2",{children:"النشاط غير موجود"}),(0,a.jsx)(m.default,{href:"/dashboard/activities",children:"العودة للأنشطة"})]});let H=g.participations.filter(e=>e.student),L=g.participations.filter(e=>e.teacher);return(0,a.jsxs)("div",{className:_.default.container,children:[(0,a.jsxs)(m.default,{href:"/dashboard/activities",className:_.default.backLink,children:[(0,a.jsx)(s.ArrowRight,{size:18}),"العودة لقائمة الأنشطة"]}),(0,a.jsxs)("div",{className:_.default.header,children:[(0,a.jsxs)("div",{className:_.default.headerInfo,children:[(0,a.jsx)("span",{className:_.default.categoryBadge,children:g.category.name}),(0,a.jsx)("h1",{children:g.title}),g.description&&(0,a.jsx)("p",{children:g.description})]}),(0,a.jsxs)("div",{className:_.default.headerActions,children:[(0,a.jsxs)("select",{value:g.status,onChange:e=>F(e.target.value),className:_.default.statusSelect,children:[(0,a.jsx)("option",{value:"upcoming",children:"قادمة"}),(0,a.jsx)("option",{value:"ongoing",children:"جارية"}),(0,a.jsx)("option",{value:"completed",children:"منتهية"}),(0,a.jsx)("option",{value:"cancelled",children:"ملغاة"})]}),(0,a.jsx)("button",{className:_.default.deleteBtn,onClick:P,children:(0,a.jsx)(o.Trash2,{size:18})})]})]}),(0,a.jsxs)("div",{className:_.default.detailsGrid,children:[(0,a.jsxs)("div",{className:_.default.detailCard,children:[(0,a.jsx)(i.Calendar,{size:20}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"التاريخ"}),(0,a.jsx)("strong",{children:new Date(g.date).toLocaleDateString("ar-SA",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),g.time&&(0,a.jsxs)("div",{className:_.default.detailCard,children:[(0,a.jsx)(l.Clock,{size:20}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"الوقت"}),(0,a.jsx)("strong",{children:g.time})]})]}),g.location&&(0,a.jsxs)("div",{className:_.default.detailCard,children:[(0,a.jsx)(d.MapPin,{size:20}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"المكان"}),(0,a.jsx)("strong",{children:g.location})]})]}),(0,a.jsxs)("div",{className:_.default.detailCard,children:[(0,a.jsx)(r.Users,{size:20}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"المشاركين"}),(0,a.jsxs)("strong",{children:[g.participations.length," ",g.maxParticipants?`/ ${g.maxParticipants}`:""]})]})]}),g.teacher&&(0,a.jsxs)("div",{className:_.default.detailCard,children:[(0,a.jsx)(h.User,{size:20}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{children:"المسؤول"}),(0,a.jsx)("strong",{children:g.teacher.name})]})]})]}),(0,a.jsxs)("div",{className:_.default.participantsSection,children:[(0,a.jsxs)("div",{className:_.default.sectionHeader,children:[(0,a.jsx)("h2",{children:"المشاركون"}),(0,a.jsxs)("button",{className:_.default.addBtn,onClick:()=>S(!0),children:[(0,a.jsx)(c.UserPlus,{size:18}),"إضافة مشارك"]})]}),(0,a.jsxs)("div",{className:_.default.participantGroup,children:[(0,a.jsxs)("h3",{children:["الطلاب (",H.length,")"]}),0===H.length?(0,a.jsx)("p",{className:_.default.emptyText,children:"لم يتم تسجيل طلاب بعد"}):(0,a.jsx)("div",{className:_.default.participantsList,children:H.map(e=>(0,a.jsxs)("div",{className:_.default.participantCard,children:[(0,a.jsxs)("div",{className:_.default.participantInfo,children:[(0,a.jsx)("div",{className:_.default.avatar,children:e.student?.name.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{children:e.student?.name}),(0,a.jsxs)("span",{children:[e.student?.studentId," - ",e.student?.grade]})]})]}),(0,a.jsxs)("div",{className:_.default.participantMeta,children:[(0,a.jsx)("span",{className:_.default.roleBadge,children:O(e.role)}),(0,a.jsx)("span",{className:`${_.default.statusBadge} ${_.default[`status${e.status}`]}`,children:E(e.status)})]}),(0,a.jsxs)("div",{className:_.default.participantActions,children:[(0,a.jsxs)("button",{className:_.default.evalBtn,onClick:()=>{A(e),T(!0)},children:[(0,a.jsx)(n.Star,{size:16}),e.evaluations.length>0?`${e.evaluations[0].score}/10`:"تقييم"]}),(0,a.jsx)("button",{className:_.default.removeBtn,onClick:()=>$(e.id),children:(0,a.jsx)(u.X,{size:16})})]})]},e.id))})]}),(0,a.jsxs)("div",{className:_.default.participantGroup,children:[(0,a.jsxs)("h3",{children:["المدرسون (",L.length,")"]}),0===L.length?(0,a.jsx)("p",{className:_.default.emptyText,children:"لم يتم تسجيل مدرسين بعد"}):(0,a.jsx)("div",{className:_.default.participantsList,children:L.map(e=>(0,a.jsxs)("div",{className:_.default.participantCard,children:[(0,a.jsxs)("div",{className:_.default.participantInfo,children:[(0,a.jsx)("div",{className:_.default.avatarTeacher,children:e.teacher?.name.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{children:e.teacher?.name}),(0,a.jsx)("span",{children:e.teacher?.employeeId})]})]}),(0,a.jsxs)("div",{className:_.default.participantMeta,children:[(0,a.jsx)("span",{className:_.default.roleBadge,children:O(e.role)}),(0,a.jsx)("span",{className:`${_.default.statusBadge} ${_.default[`status${e.status}`]}`,children:E(e.status)})]}),(0,a.jsxs)("div",{className:_.default.participantActions,children:[(0,a.jsxs)("button",{className:_.default.evalBtn,onClick:()=>{A(e),T(!0)},children:[(0,a.jsx)(n.Star,{size:16}),e.evaluations.length>0?`${e.evaluations[0].score}/10`:"تقييم"]}),(0,a.jsx)("button",{className:_.default.removeBtn,onClick:()=>$(e.id),children:(0,a.jsx)(u.X,{size:16})})]})]},e.id))})]})]}),B&&(0,a.jsx)(f,{activityId:g.id,students:k,teachers:q,existingStudentIds:H.map(e=>e.student?.id).filter(Boolean),existingTeacherIds:L.map(e=>e.teacher?.id).filter(Boolean),onClose:()=>S(!1),onSave:()=>{S(!1),G()}}),w&&I&&(0,a.jsx)(v,{participation:I,onClose:()=>{T(!1),A(null)},onSave:()=>{T(!1),A(null),G()}})]})}function f({activityId:e,students:s,teachers:i,existingStudentIds:l,existingTeacherIds:d,onClose:r,onSave:n}){let[c,o]=(0,t.useState)("student"),[p,h]=(0,t.useState)(""),[m,x]=(0,t.useState)("participant"),[j,f]=(0,t.useState)(!1),[v,y]=(0,t.useState)(""),g=s.filter(e=>!l.includes(e.id)),N=i.filter(e=>!d.includes(e.id)),k=async a=>{if(a.preventDefault(),!p)return void y("يرجى اختيار المشارك");f(!0),y("");try{let a=await fetch("/api/participations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({activityId:e,["student"===c?"studentId":"teacherId"]:p,role:m})}),t=await a.json();if(!a.ok)return void y(t.error||"حدث خطأ");n()}catch{y("حدث خطأ في الاتصال")}finally{f(!1)}};return(0,a.jsx)("div",{className:_.default.modalOverlay,onClick:r,children:(0,a.jsxs)("div",{className:_.default.modal,onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:_.default.modalHeader,children:[(0,a.jsx)("h2",{children:"إضافة مشارك"}),(0,a.jsx)("button",{onClick:r,children:(0,a.jsx)(u.X,{size:20})})]}),(0,a.jsxs)("form",{onSubmit:k,className:_.default.modalForm,children:[(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"نوع المشارك"}),(0,a.jsxs)("div",{className:_.default.radioGroup,children:[(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"radio",checked:"student"===c,onChange:()=>{o("student"),h("")}}),"طالب"]}),(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"radio",checked:"teacher"===c,onChange:()=>{o("teacher"),h("")}}),"مدرس"]})]})]}),(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsxs)("label",{children:["اختر ","student"===c?"الطالب":"المدرس"]}),(0,a.jsxs)("select",{value:p,onChange:e=>h(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"اختر..."}),"student"===c?g.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.studentId]},e.id)):N.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," - ",e.employeeId]},e.id))]})]}),(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"الدور"}),(0,a.jsxs)("select",{value:m,onChange:e=>x(e.target.value),children:[(0,a.jsx)("option",{value:"participant",children:"مشارك"}),(0,a.jsx)("option",{value:"organizer",children:"منظم"}),(0,a.jsx)("option",{value:"presenter",children:"مقدم"}),(0,a.jsx)("option",{value:"judge",children:"محكم"})]})]}),v&&(0,a.jsx)("div",{className:_.default.formError,children:v}),(0,a.jsxs)("div",{className:_.default.modalActions,children:[(0,a.jsx)("button",{type:"button",onClick:r,className:_.default.cancelBtn,children:"إلغاء"}),(0,a.jsx)("button",{type:"submit",className:_.default.submitBtn,disabled:j,children:j?"جاري الإضافة...":"إضافة"})]})]})]})})}function v({participation:e,onClose:s,onSave:i}){let l=e.evaluations[0],[d,r]=(0,t.useState)({score:l?.score||7,performance:l?.performance||"",strengths:l?.strengths||"",improvements:l?.improvements||"",comments:l?.comments||""}),[n,c]=(0,t.useState)(!1),[o,p]=(0,t.useState)(""),h=e.student?.name||e.teacher?.name||"",m=async a=>{a.preventDefault(),c(!0),p("");try{let a=await fetch("/api/activity-evaluations",{method:l?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:l?.id,participationId:e.id,...d})}),t=await a.json();if(!a.ok)return void p(t.error||"حدث خطأ");i()}catch{p("حدث خطأ في الاتصال")}finally{c(!1)}};return(0,a.jsx)("div",{className:_.default.modalOverlay,onClick:s,children:(0,a.jsxs)("div",{className:_.default.modal,onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:_.default.modalHeader,children:[(0,a.jsxs)("h2",{children:["تقييم ",h]}),(0,a.jsx)("button",{onClick:s,children:(0,a.jsx)(u.X,{size:20})})]}),(0,a.jsxs)("form",{onSubmit:m,className:_.default.modalForm,children:[(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"التقييم (1-10)"}),(0,a.jsxs)("div",{className:_.default.scoreInput,children:[(0,a.jsx)("input",{type:"range",min:"1",max:"10",value:d.score,onChange:e=>r({...d,score:parseInt(e.target.value)})}),(0,a.jsxs)("span",{className:_.default.scoreValue,children:[d.score,"/10"]})]})]}),(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"مستوى الأداء"}),(0,a.jsxs)("select",{value:d.performance,onChange:e=>r({...d,performance:e.target.value}),children:[(0,a.jsx)("option",{value:"",children:"اختر..."}),(0,a.jsx)("option",{value:"ممتاز",children:"ممتاز"}),(0,a.jsx)("option",{value:"جيد جداً",children:"جيد جداً"}),(0,a.jsx)("option",{value:"جيد",children:"جيد"}),(0,a.jsx)("option",{value:"مقبول",children:"مقبول"}),(0,a.jsx)("option",{value:"ضعيف",children:"ضعيف"})]})]}),(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"نقاط القوة"}),(0,a.jsx)("textarea",{value:d.strengths,onChange:e=>r({...d,strengths:e.target.value}),rows:2,placeholder:"أذكر نقاط القوة..."})]}),(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"نقاط التحسين"}),(0,a.jsx)("textarea",{value:d.improvements,onChange:e=>r({...d,improvements:e.target.value}),rows:2,placeholder:"أذكر نقاط التحسين..."})]}),(0,a.jsxs)("div",{className:_.default.formGroup,children:[(0,a.jsx)("label",{children:"ملاحظات إضافية"}),(0,a.jsx)("textarea",{value:d.comments,onChange:e=>r({...d,comments:e.target.value}),rows:2,placeholder:"ملاحظات..."})]}),o&&(0,a.jsx)("div",{className:_.default.formError,children:o}),(0,a.jsxs)("div",{className:_.default.modalActions,children:[(0,a.jsx)("button",{type:"button",onClick:s,className:_.default.cancelBtn,children:"إلغاء"}),(0,a.jsx)("button",{type:"submit",className:_.default.submitBtn,disabled:n,children:n?"جاري الحفظ...":"حفظ التقييم"})]})]})]})})}e.s(["default",()=>j])}]);