(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,63059,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],63059)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},87130,e=>{"use strict";let t=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},82293,e=>{"use strict";let t=(0,e.i(75254).default)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["UserCheck",()=>t],82293)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},3116,e=>{"use strict";let t=(0,e.i(75254).default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);e.s(["Clock",()=>t],3116)},63209,e=>{"use strict";let t=(0,e.i(75254).default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>t],63209)},73884,e=>{"use strict";let t=(0,e.i(75254).default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],73884)},69638,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],69638)},17801,e=>{"use strict";let t=(0,e.i(75254).default)("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserMinus",()=>t],17801)},97441,e=>{e.v({actionBtn:"attendance-module__Bxmkza__actionBtn",addButton:"attendance-module__Bxmkza__addButton",avatar:"attendance-module__Bxmkza__avatar",btnAbsent:"attendance-module__Bxmkza__btnAbsent",btnCheckout:"attendance-module__Bxmkza__btnCheckout",btnLate:"attendance-module__Bxmkza__btnLate",btnPresent:"attendance-module__Bxmkza__btnPresent",cancelBtn:"attendance-module__Bxmkza__cancelBtn",closeModal:"attendance-module__Bxmkza__closeModal",container:"attendance-module__Bxmkza__container",controls:"attendance-module__Bxmkza__controls",dateDisplay:"attendance-module__Bxmkza__dateDisplay",dateInput:"attendance-module__Bxmkza__dateInput",dateNav:"attendance-module__Bxmkza__dateNav",empty:"attendance-module__Bxmkza__empty",filterGroup:"attendance-module__Bxmkza__filterGroup",filterSelect:"attendance-module__Bxmkza__filterSelect",formError:"attendance-module__Bxmkza__formError",formGroup:"attendance-module__Bxmkza__formGroup",header:"attendance-module__Bxmkza__header",loader:"attendance-module__Bxmkza__loader",loading:"attendance-module__Bxmkza__loading",modal:"attendance-module__Bxmkza__modal",modalActions:"attendance-module__Bxmkza__modalActions",modalForm:"attendance-module__Bxmkza__modalForm",modalHeader:"attendance-module__Bxmkza__modalHeader",modalOverlay:"attendance-module__Bxmkza__modalOverlay",navBtn:"attendance-module__Bxmkza__navBtn",pageBtn:"attendance-module__Bxmkza__pageBtn",pageInfo:"attendance-module__Bxmkza__pageInfo",pagination:"attendance-module__Bxmkza__pagination",quickActions:"attendance-module__Bxmkza__quickActions",quickAdd:"attendance-module__Bxmkza__quickAdd",quickBtn:"attendance-module__Bxmkza__quickBtn",registeredBadge:"attendance-module__Bxmkza__registeredBadge",slideUp:"attendance-module__Bxmkza__slideUp",spin:"attendance-module__Bxmkza__spin",statAbsent:"attendance-module__Bxmkza__statAbsent",statCard:"attendance-module__Bxmkza__statCard",statExcused:"attendance-module__Bxmkza__statExcused",statLabel:"attendance-module__Bxmkza__statLabel",statLate:"attendance-module__Bxmkza__statLate",statPresent:"attendance-module__Bxmkza__statPresent",statValue:"attendance-module__Bxmkza__statValue",statsGrid:"attendance-module__Bxmkza__statsGrid",status:"attendance-module__Bxmkza__status",statusAbsent:"attendance-module__Bxmkza__statusAbsent",statusExcused:"attendance-module__Bxmkza__statusExcused",statusLate:"attendance-module__Bxmkza__statusLate",statusPresent:"attendance-module__Bxmkza__statusPresent",submitBtn:"attendance-module__Bxmkza__submitBtn",subtitle:"attendance-module__Bxmkza__subtitle",table:"attendance-module__Bxmkza__table",tableCard:"attendance-module__Bxmkza__tableCard",teacherButtons:"attendance-module__Bxmkza__teacherButtons",teacherId:"attendance-module__Bxmkza__teacherId",teacherInfo:"attendance-module__Bxmkza__teacherInfo",teacherName:"attendance-module__Bxmkza__teacherName",title:"attendance-module__Bxmkza__title"})},88742,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(87316),l=e.i(54385),n=e.i(3116),d=e.i(82293),c=e.i(17801),i=e.i(63209),r=e.i(69638),u=e.i(73884),o=e.i(63059),m=e.i(73375),h=e.i(87130),_=e.i(7233),x=e.i(37727),f=e.i(92270),k=e.i(97441);function j(){let[e,x]=(0,a.useState)([]),[j,y]=(0,a.useState)([]),[v,B]=(0,a.useState)(!0),[b,z]=(0,a.useState)(new Date().toISOString().split("T")[0]),[g,C]=(0,a.useState)(""),[N,S]=(0,a.useState)(1),[I,A]=(0,a.useState)(1),[w,O]=(0,a.useState)(!1),[T,L]=(0,a.useState)(null),[P,$]=(0,a.useState)(!1),[D,q]=(0,a.useState)(!1),[M,E]=(0,a.useState)({present:0,absent:0,late:0,excused:0}),F=(0,a.useCallback)(async()=>{B(!0);try{let e=new URLSearchParams({page:N.toString(),limit:"20",startDate:b,endDate:b});g&&e.set("status",g);let t=await fetch(`/api/attendance?${e}`),a=await t.json();x(a.records),A(a.pagination.totalPages||1);let s={present:0,absent:0,late:0,excused:0};a.records.forEach(e=>{e.status in s&&s[e.status]++}),E(s)}catch(e){console.error("Failed to fetch attendance:",e)}finally{B(!1)}},[N,b,g]),G=async()=>{try{let e=await fetch("/api/teachers?limit=100"),t=await e.json();y(t.teachers||[])}catch(e){console.error("Failed to fetch teachers:",e)}},U=async()=>{try{let e=await fetch("/api/auth/session"),t=await e.json();t.authenticated&&L(t.user)}catch(e){console.error("Failed to fetch user:",e)}};(0,a.useEffect)(()=>{F()},[F]),(0,a.useEffect)(()=>{G(),U()},[]),(0,a.useEffect)(()=>{if(T?.role==="teacher"&&e.length>0){let t=new Date().toISOString().split("T")[0];q(!!e.find(e=>e.date.split("T")[0]===t))}},[e,T]);let H=async()=>{$(!0);try{let e=new Date,t=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selfRegister:!0,date:e.toISOString().split("T")[0],checkIn:e.toISOString(),status:"present"})});if(t.ok)q(!0),F();else{let e=await t.json();alert(e.error||"حدث خطأ في تسجيل الحضور")}}catch(e){console.error("Failed to register attendance:",e),alert("حدث خطأ في الاتصال")}finally{$(!1)}},R=T?.role==="teacher",V=async(e,t)=>{try{let a=new Date,s="present"===t||"late"===t?a.toISOString():null;await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacherId:e,date:b,checkIn:s,status:t})}),F()}catch(e){console.error("Failed to mark attendance:",e)}},J=async e=>{try{let t=new Date;await fetch(`/api/attendance/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({checkOut:t.toISOString()})}),F()}catch(e){console.error("Failed to record checkout:",e)}},X=e=>e?new Date(e).toLocaleTimeString("ar-SA",{hour:"2-digit",minute:"2-digit"}):"-",K=e=>{let t=new Date(b);t.setDate(t.getDate()+e),z(t.toISOString().split("T")[0]),S(1)};return(0,t.jsxs)("div",{className:k.default.container,children:[(0,t.jsxs)("div",{className:k.default.header,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:k.default.title,children:"الحضور والانصراف"}),(0,t.jsx)("p",{className:k.default.subtitle,children:R?"سجلات حضورك وانصرافك":"تسجيل ومتابعة حضور وانصراف المدرسين"})]}),R?D?(0,t.jsxs)("div",{className:k.default.registeredBadge,children:[(0,t.jsx)(r.CheckCircle,{size:18}),"تم تسجيل حضورك اليوم ✓"]}):(0,t.jsxs)("button",{className:k.default.addButton,onClick:H,disabled:P,children:[(0,t.jsx)(d.UserCheck,{size:18}),P?"جاري التسجيل...":"تسجيل حضوري"]}):(0,t.jsxs)("button",{className:k.default.addButton,onClick:()=>O(!0),children:[(0,t.jsx)(_.Plus,{size:18}),"تسجيل الحضور"]})]}),(0,t.jsxs)("div",{className:k.default.statsGrid,children:[(0,t.jsxs)("div",{className:`${k.default.statCard} ${k.default.statPresent}`,children:[(0,t.jsx)(d.UserCheck,{size:24}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:k.default.statValue,children:M.present}),(0,t.jsx)("p",{className:k.default.statLabel,children:"حاضر"})]})]}),(0,t.jsxs)("div",{className:`${k.default.statCard} ${k.default.statAbsent}`,children:[(0,t.jsx)(c.UserMinus,{size:24}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:k.default.statValue,children:M.absent}),(0,t.jsx)("p",{className:k.default.statLabel,children:"غائب"})]})]}),(0,t.jsxs)("div",{className:`${k.default.statCard} ${k.default.statLate}`,children:[(0,t.jsx)(n.Clock,{size:24}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:k.default.statValue,children:M.late}),(0,t.jsx)("p",{className:k.default.statLabel,children:"متأخر"})]})]}),(0,t.jsxs)("div",{className:`${k.default.statCard} ${k.default.statExcused}`,children:[(0,t.jsx)(i.AlertCircle,{size:24}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:k.default.statValue,children:M.excused}),(0,t.jsx)("p",{className:k.default.statLabel,children:"إجازة"})]})]})]}),(0,t.jsxs)("div",{className:k.default.controls,children:[(0,t.jsxs)("div",{className:k.default.dateNav,children:[(0,t.jsx)("button",{className:k.default.navBtn,onClick:()=>K(-1),children:(0,t.jsx)(o.ChevronRight,{size:20})}),(0,t.jsxs)("div",{className:k.default.dateDisplay,children:[(0,t.jsx)(s.Calendar,{size:18}),(0,t.jsx)("input",{type:"date",value:b,onChange:e=>{z(e.target.value),S(1)},className:k.default.dateInput})]}),(0,t.jsx)("button",{className:k.default.navBtn,onClick:()=>K(1),children:(0,t.jsx)(m.ChevronLeft,{size:20})})]}),(0,t.jsxs)("div",{className:k.default.filterGroup,children:[(0,t.jsx)(h.Filter,{size:18}),(0,t.jsxs)("select",{value:g,onChange:e=>{C(e.target.value),S(1)},className:k.default.filterSelect,children:[(0,t.jsx)("option",{value:"",children:"جميع الحالات"}),(0,t.jsx)("option",{value:"present",children:"حاضر"}),(0,t.jsx)("option",{value:"absent",children:"غائب"}),(0,t.jsx)("option",{value:"late",children:"متأخر"}),(0,t.jsx)("option",{value:"excused",children:"إجازة"})]})]})]}),(0,t.jsx)("div",{className:k.default.tableCard,children:v?(0,t.jsxs)("div",{className:k.default.loading,children:[(0,t.jsx)("div",{className:k.default.loader}),(0,t.jsx)("p",{children:"جاري التحميل..."})]}):0===e.length?(0,t.jsxs)("div",{className:k.default.empty,children:[(0,t.jsx)(l.ClipboardCheck,{size:48}),(0,t.jsx)("h3",{children:"لا توجد سجلات"}),(0,t.jsx)("p",{children:"لم يتم تسجيل حضور في هذا اليوم"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("table",{className:k.default.table,children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"المدرس"}),(0,t.jsx)("th",{children:"الحالة"}),(0,t.jsx)("th",{children:"وقت الحضور"}),(0,t.jsx)("th",{children:"وقت الانصراف"}),(0,t.jsx)("th",{children:"ملاحظات"}),!R&&(0,t.jsx)("th",{children:"إجراءات"})]})}),(0,t.jsx)("tbody",{children:e.map(e=>{var a;let s,l=(a=e.status,(s={present:{label:"حاضر",icon:(0,t.jsx)(r.CheckCircle,{size:16}),class:"statusPresent"},absent:{label:"غائب",icon:(0,t.jsx)(u.XCircle,{size:16}),class:"statusAbsent"},late:{label:"متأخر",icon:(0,t.jsx)(n.Clock,{size:16}),class:"statusLate"},excused:{label:"إجازة",icon:(0,t.jsx)(i.AlertCircle,{size:16}),class:"statusExcused"}})[a]||s.present);return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:k.default.teacherInfo,children:[(0,t.jsx)("div",{className:k.default.avatar,children:e.teacher.name.charAt(0)}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:k.default.teacherName,children:e.teacher.name}),(0,t.jsx)("p",{className:k.default.teacherId,children:e.teacher.employeeId})]})]})}),(0,t.jsx)("td",{children:(0,t.jsxs)("span",{className:`${k.default.status} ${k.default[l.class]}`,children:[l.icon,l.label]})}),(0,t.jsx)("td",{children:X(e.checkIn)}),(0,t.jsx)("td",{children:X(e.checkOut)}),(0,t.jsx)("td",{children:e.notes||"-"}),!R&&(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:k.default.quickActions,children:[(0,t.jsx)("button",{className:`${k.default.actionBtn} ${k.default.btnPresent}`,onClick:()=>V(e.teacherId,"present"),title:"حاضر",children:(0,t.jsx)(r.CheckCircle,{size:14})}),(0,t.jsx)("button",{className:`${k.default.actionBtn} ${k.default.btnLate}`,onClick:()=>V(e.teacherId,"late"),title:"متأخر",children:(0,t.jsx)(n.Clock,{size:14})}),(0,t.jsx)("button",{className:`${k.default.actionBtn} ${k.default.btnAbsent}`,onClick:()=>V(e.teacherId,"absent"),title:"غائب",children:(0,t.jsx)(u.XCircle,{size:14})}),("present"===e.status||"late"===e.status)&&e.checkIn&&!e.checkOut&&(0,t.jsx)("button",{className:`${k.default.actionBtn} ${k.default.btnCheckout}`,onClick:()=>J(e.id),title:"تسجيل الانصراف",children:(0,t.jsx)(f.LogOut,{size:14})})]})})]},e.id)})})]}),I>1&&(0,t.jsxs)("div",{className:k.default.pagination,children:[(0,t.jsxs)("button",{className:k.default.pageBtn,disabled:1===N,onClick:()=>S(e=>e-1),children:[(0,t.jsx)(o.ChevronRight,{size:18}),"السابق"]}),(0,t.jsxs)("span",{className:k.default.pageInfo,children:["صفحة ",N," من ",I]}),(0,t.jsxs)("button",{className:k.default.pageBtn,disabled:N===I,onClick:()=>S(e=>e+1),children:["التالي",(0,t.jsx)(m.ChevronLeft,{size:18})]})]})]})}),w&&(0,t.jsx)(p,{teachers:j,selectedDate:b,onClose:()=>O(!1),onSave:()=>{O(!1),F()}})]})}function p({teachers:e,selectedDate:s,onClose:l,onSave:n}){let[d,c]=(0,a.useState)({teacherId:"",status:"present",checkInTime:new Date().toTimeString().slice(0,5)}),[i,r]=(0,a.useState)(!1),[u,o]=(0,a.useState)(""),m=async e=>{if(e.preventDefault(),!d.teacherId)return void o("يرجى اختيار المدرس");r(!0),o("");try{let[e,t]=d.checkInTime.split(":"),a=new Date(s);a.setHours(parseInt(e),parseInt(t),0,0);let l="present"===d.status||"late"===d.status?a.toISOString():null,c=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({teacherId:parseInt(d.teacherId),date:s,checkIn:l,status:d.status})});if(!c.ok){let e=await c.json();o(e.error||"حدث خطأ");return}n()}catch{o("حدث خطأ في الاتصال")}finally{r(!1)}};return(0,t.jsx)("div",{className:k.default.modalOverlay,onClick:l,children:(0,t.jsxs)("div",{className:k.default.modal,onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:k.default.modalHeader,children:[(0,t.jsx)("h2",{children:"تسجيل الحضور"}),(0,t.jsx)("button",{className:k.default.closeModal,onClick:l,children:(0,t.jsx)(x.X,{size:20})})]}),(0,t.jsxs)("form",{onSubmit:m,className:k.default.modalForm,children:[(0,t.jsxs)("div",{className:k.default.formGroup,children:[(0,t.jsx)("label",{children:"المدرس *"}),(0,t.jsxs)("select",{value:d.teacherId,onChange:e=>c({...d,teacherId:e.target.value}),required:!0,children:[(0,t.jsx)("option",{value:"",children:"اختر المدرس"}),e.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{className:k.default.formGroup,children:[(0,t.jsx)("label",{children:"حالة الحضور *"}),(0,t.jsxs)("select",{value:d.status,onChange:e=>c({...d,status:e.target.value}),children:[(0,t.jsx)("option",{value:"present",children:"حاضر"}),(0,t.jsx)("option",{value:"late",children:"متأخر"}),(0,t.jsx)("option",{value:"absent",children:"غائب"}),(0,t.jsx)("option",{value:"excused",children:"إجازة"})]})]}),("present"===d.status||"late"===d.status)&&(0,t.jsxs)("div",{className:k.default.formGroup,children:[(0,t.jsx)("label",{children:"وقت الحضور"}),(0,t.jsx)("input",{type:"time",value:d.checkInTime,onChange:e=>c({...d,checkInTime:e.target.value})})]}),u&&(0,t.jsx)("div",{className:k.default.formError,children:u}),(0,t.jsxs)("div",{className:k.default.modalActions,children:[(0,t.jsx)("button",{type:"button",className:k.default.cancelBtn,onClick:l,children:"إلغاء"}),(0,t.jsx)("button",{type:"submit",className:k.default.submitBtn,disabled:i,children:i?"جاري الحفظ...":"تسجيل"})]})]})]})})}e.s(["default",()=>j])}]);